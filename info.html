<!doctype html>
<html>
	<head>
		<title>BOTW Cooking Simulator</title>
		<link rel='icon' href='img/food/apple.png'/>
		<link rel='stylesheet' href='style/main.css'/>
		<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
	</head>
	<body>
		<div id='wrapper'>
			<header>
				Zelda Breath of The Wild: Cooking Simulator	
			</header>

			<nav>
				<ul class='navbar'>
					<li class='navbar-item'><a href='index.html'>Cook</a></li>
					<li class='navbar-item'>Learn</li>
					<li class='navbar-item'>Recipes</li>
				</ul>
			</nav>

			<div id='dish'>
				<div id='dishHeader'>
					<span id='dishImage'></span>
					<span id='dishTitle'></span>
				</div>
				<div id='dishType'></div>
				<div id='dishDesc'></div>
				<table id='dishStats'>
					<thead>
						<tr>
							<th>Times repeated</th>
							<th>1</th>
							<th>2</th>
							<th>3</th>
							<th>4</th>
							<th>5</th>
						</tr>
					</thead>
					<tbody>
						<tr id='dishHearts'></tr>
						<tr id='dishDuration'></tr>
						<tr id='dishLevel'></tr>
					</tbody>
				</table>
				<h3>Appears in:</h3>
				<div id='dishRelated'></div>
			</div>
		</div>

		<script src='util.js'></script>
		<script>
			var items = [],
				recipes = [];

			/* DOM Vars */
			var dish = document.getElementById('dish')
				, dishImage = document.getElementById('dishImage')
				, dishTitle = document.getElementById('dishTitle')
				, dishDesc = document.getElementById('dishDesc')
				, dishType = document.getElementById('dishType')
				, dishHearts = document.getElementById('dishHearts')
				, dishRelated = document.getElementById('dishRelated')/*
				, dishEffect = document.getElementById('dishEffect')
				, dishDuration = document.getElementById('dishDuration')
				, dishLevel = document.getElementById('dishLevel')
				, ingredients = document.getElementById('ingredients').getElementsByClassName('ing')
				, ingredientList = document.getElementById('ingredientList')
				, clearBtn = document.getElementById('clearBtn')
				, sortSelect = document.getElementById('sortSelect');*/;

			/* Get the food.json file using the Fetch API */
			if (self.fetch) {
				fetch('food.json', {
					"method": "GET",
					"cache": "default"
				}).then(function(response) {
					return response.json();
				}).then(function(data) {
					var id = getParam("id");
					items = data;
					if (id) {
						if (id < 0 || id >= items.length)
							dish.innerHTML = "Out of bounds ID : " + id;
						else {
							fetch('recipes.json', {
								"method": "GET",
								"cache": "default"
							})
							.then(function(response) { return response.json();})
							.then(function(data) { recipes = data; UIdisplayIngredientInfo(items[id]); });
						}
					} else {
						dish.innerHTML = "Missing ID ! Request this page with the GET method and 'id' argument.";
					}
				});
				
			} else {
				console.log("Your browser is outdated and does not support the Fetch API.");
			}

			function UIdisplayIngredientInfo(ing) {
				if (!ing) return ;
				dishImage.innerHTML = '<img src="img/food/' + ing.image + '"/>';
				dishTitle.innerHTML = ing.name;
				dishType.innerHTML = 'In class: ' + ing.type.join(' > ');
				dishDesc.innerHTML = ing.description;
				setRow(dishHearts, "Hearts Healed", ing.hearts, htmlHearts);
				setRow(dishDuration, "+ Duration (s)", ing.duration, null);
				setRow(dishLevel, "Effect Level", ing.level, null);
				setRelated(ing);
			}

			/*
			 * Fills a given row (DOM) from 'table' the data in the array 'data'
			 * Removes any data that was previously on this row
			 */
			function setRow(row, title, data, transformFunction) {
				while (row.firstChild) {
					row.removeChild(row.firstChild);
				}
				row.appendChild(myCreateElement("td", {innerHTML: title}));
				for (var i = 0; i < data.length; i++) {
					row.appendChild(myCreateElement("td", {
						innerHTML: transformFunction ? transformFunction(data[i]) : data[i]
					}));
				}
			}

			function setRelated(ing) {
				var related = recipes.filter(function(x) {
						for (var i = 0; i < ing.type.length; i++) {
							if (x.required.indexOf(ing.type[i]) != -1)
								return true;
						}
						return false;
					});

				if (related.length == 0) {
					dishRelated.innerHTML = 'No match found.';
				} else {
					related.forEach(function(x) {
						dishRelated.appendChild(myCreateElement("div", {
							innerHTML: '<div class="sq sq-mini ing"><img src="img/food/' + x.image + '"/></div>' + x.name
						}));
					})
				}
			}
		</script>
	</body>
</html>